<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시글 작성</title>
    <link rel="stylesheet" href="/css/board/boardToWrite.css">
    <script defer src="/js/board/boardToWrite.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/menu.css" rel="stylesheet">
</head>
<body>
<div th:insert="~{fragments/menu :: menuBar}"></div>

<div class="container">
    <div class="form-header">
        <h2>게시글 작성</h2>
    </div>

    <form id="post-form" method="post" th:action="@{/board/write}">
        <div class="form-group">
            <!-- 호선 선택 부분 -->
            <select id="line-select" th:field="${board.stationLine}" required>
                <option value="default">호선 선택</option>
                <option th:each="num : ${#numbers.sequence(1,9)}" th:value="${numStat.count + '호선'}" th:text="${numStat.count} + '호선'" th:class="${'line-' + numStat.count}"></option>
            </select>

            <!-- 역 선택 부분 -->
            <select id="station-select" th:field="${board.stationName}" required>
                <option th:value="default">역 선택</option>
                <!-- 추후 DB에서 가져온 역 정보를 이곳에 넣을 예정 -->
            </select>

            <!-- 로그인 후 글쓰려고 들어갔을 때 아이디를 볼 수 있도록 하는 기능 추가 -->
            <span class="user-id" th:field="${board.user.userId}" th:text="${board.user.nickname}"></span>
            <input type="hidden" th:field="${board.user.userId}" />
            <!-- hidden으로 user id 받아옴-->
        </div>

        <div class="form-group">
            <input type="text" placeholder="제목" th:field="${board.title}" id="title" required>
        </div>

        <div class="form-group">
            <textarea th:field="${board.boardText}" placeholder="내용을 입력하세요" id="text" required></textarea>
        </div>
        <div class="form-group">
            <button type="submit" th:if="${param.no == null}">글쓰기</button>
        </div>
    </form>
    <form th:action="@{/board/update}" method="post" id="update-form">
        <div class="form-group">
            <input type="hidden" th:name="stationLine" id="hidden-station-line" />
            <input type="hidden" th:name="stationName" id="hidden-station-name" />
            <input type="hidden" th:name="title" id="hidden-title" />
            <input type="hidden" th:name="boardText" id="hidden-board-text" />
            <input type="hidden" th:name="boardNo" th:value="${board.boardNo}" />
            <button type="submit" th:if="${param.no != null}">수정</button>
        </div>
    </form>
</div>
<script th:inline="javascript">

    // 자바스크립트를 사용해 폼이 제출될 때 호선 선택 확인 알람
    document.getElementById('post-form').addEventListener('submit', function(event) {
        const lineSelect = document.getElementById('line-select');
        const stationSelect = document.getElementById('station-select');

        if (lineSelect.value === 'default') {
            event.preventDefault();
            alert('호선을 선택해주세요.');
        } else if (stationSelect.value === 'default') {
            event.preventDefault();
            alert('역을 선택해주세요.');
        }
    });
    document.getElementById('update-form').addEventListener('submit', function() {
        // 수정 버튼 클릭 시 첫 번째 form의 값을 업데이트
        document.getElementById('hidden-station-line').value = document.getElementById('line-select').value;
        document.getElementById('hidden-station-name').value = document.getElementById('station-select').value;
        document.getElementById('hidden-title').value = document.getElementById('title').value;
        document.getElementById('hidden-board-text').value = document.getElementById('text').value;
    });

    document.getElementById('line-select').addEventListener('change', function() {
        const selectedLine = this.value;
        const stationSelect = document.getElementById('station-select');
        stationSelect.innerHTML = '';

        const lineSelect = document.getElementById('line-select');

        const lineColors = {
            '1호선': '#0032a0',
            '2호선': '#00b140',
            '3호선': '#fc4c02',
            '4호선': '#00a9e0',
            '5호선': '#a05eb5',
            '6호선': '#a9431e',
            '7호선': '#67823a',
            '8호선': '#e31c79',
            '9호선': '#8c8279',
            'default': 'white' // 기본값
        };

        // 선택한 호선에 따라 배경색 변경
        if (selectedLine !== 'default') {
            lineSelect.style.backgroundColor = lineColors[selectedLine];
            lineSelect.style.color = '#fff'; // 텍스트 색상도 변경
        } else {
            lineSelect.style.backgroundColor = lineColors['default'];
            lineSelect.style.color = '#000'; // 기본 텍스트 색상
        }

        if (selectedLine !== 'default') {
            // 이쪽은 DB에서 가져온 데이터 바탕으로 역 정보를 추가 예정, 예시로 일단 몇가지 넣어 놓음
            const stations = {
                '1호선': [[${station.lineOne}]],
                '2호선': [[${station.lineTwo}]],
                '3호선': [[${station.lineThree}]],
                '4호선': [[${station.lineFour}]],
                '5호선': [[${station.lineFive}]],
                '6호선': [[${station.lineSix}]],
                '7호선': [[${station.lineSeven}]],
                '8호선': [[${station.lineEight}]],
                '9호선': [[${station.lineNine}]]
            };

            stations[selectedLine].forEach(function(station) {
                const option = document.createElement('option');
                option.value = station;
                option.textContent = station;
                stationSelect.appendChild(option);
            });
        } else {
            const defaultOption = document.createElement('option');
            defaultOption.value = 'default';
            defaultOption.textContent = '역 선택';
            stationSelect.appendChild(defaultOption);
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        const lineSelect = document.getElementById('line-select');
        const stationSelect = document.getElementById('station-select');

        // 초기 selectedLine 값 설정 (예: 1호선)
        const initialLine = lineSelect.value;
        updateStations(initialLine);

        lineSelect.addEventListener('change', function() {
            const selectedLine = this.value;
            updateStations(selectedLine);
        });

        function updateStations(selectedLine) {
            stationSelect.innerHTML = '';

            const lineColors = {
                '1호선': '#0032a0',
                '2호선': '#00b140',
                '3호선': '#fc4c02',
                '4호선': '#00a9e0',
                '5호선': '#a05eb5',
                '6호선': '#a9431e',
                '7호선': '#67823a',
                '8호선': '#e31c79',
                '9호선': '#8c8279',
                'default': 'white' // 기본값
            };

            // 선택한 호선에 따라 배경색 변경
            if (selectedLine !== 'default') {
                lineSelect.style.backgroundColor = lineColors[selectedLine];
                lineSelect.style.color = '#fff'; // 텍스트 색상도 변경
            } else {
                lineSelect.style.backgroundColor = lineColors['default'];
                lineSelect.style.color = '#000'; // 기본 텍스트 색상
            }

            if (selectedLine !== 'default') {
                const stations = {
                    '1호선': [[${station.lineOne}]],
                    '2호선': [[${station.lineTwo}]],
                    '3호선': [[${station.lineThree}]],
                    '4호선': [[${station.lineFour}]],
                    '5호선': [[${station.lineFive}]],
                    '6호선': [[${station.lineSix}]],
                    '7호선': [[${station.lineSeven}]],
                    '8호선': [[${station.lineEight}]],
                    '9호선': [[${station.lineNine}]]
                };

                stations[selectedLine].forEach(function(station) {
                    const option = document.createElement('option');
                    option.value = station;
                    option.textContent = station;
                    stationSelect.appendChild(option);
                });
            } else {
                const defaultOption = document.createElement('option');
                defaultOption.value = 'default';
                defaultOption.textContent = '역 선택';
                stationSelect.appendChild(defaultOption);
            }
        }
    });
</script>

</body>
</html>
